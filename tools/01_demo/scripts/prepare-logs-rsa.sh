#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# DO NOT MODIFY BELOW
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


#------------------------------------------------------------------------------------------------------------------------------------
#  Prepare Inception Logs
#------------------------------------------------------------------------------------------------------------------------------------
echo "   "
echo "   "
echo "   ----------------------------------------------------------------------------------------------------------------------------------------"
echo "     🚀  Preparing Log Data"
echo "   ----------------------------------------------------------------------------------------------------------------------------------------"

for actFile in $(ls -1 $WORKING_DIR_LOGS | grep "json"); 
do 

#------------------------------------------------------------------------------------------------------------------------------------
#  Prepare the Data
#------------------------------------------------------------------------------------------------------------------------------------

      echo "      -------------------------------------------------------------------------------------------------------------------------------------"
      echo "       🛠️  Preparing Data for file $actFile"
      echo "      -------------------------------------------------------------------------------------------------------------------------------------"


      #------------------------------------------------------------------------------------------------------------------------------------
      #  Create file and structure in /tmp
      #------------------------------------------------------------------------------------------------------------------------------------
      mkdir /tmp/training-files-rsa/  >/tmp/demo.log 2>&1  || true
      rm /tmp/training-files-rsa/x*  >/tmp/demo.log 2>&1  || true
      rm /tmp/training-files-rsa/timestampedErrorFileRSA.json  >/tmp/demo.log 2>&1  || true
      rm /tmp/training-files-rsa/timestampedErrorFileRSA.json-e  >/tmp/demo.log 2>&1  || true
      rm /tmp/training-files-rsa/logs-robotshop-kafka.json >/tmp/demo.log 2>&1  || true
      cp $WORKING_DIR_LOGS/$actFile /tmp/training-files-rsa/timestampedErrorFileRSA.json
      cd /tmp/training-files-rsa/

      export my_timestamp=$(date $DATE_FORMAT_LOGS| cut -c1-7)
      #echo "DATE:$my_timestamp"
      sed -i -e "s/MY_TIMESTAMP/$my_timestamp/g" timestampedErrorFileRSA.json

      #------------------------------------------------------------------------------------------------------------------------------------
      #  Split the files in 1500 line chunks for kafkacat
      #------------------------------------------------------------------------------------------------------------------------------------
      echo "         🔨 Splitting"
      split -l 1500 ./timestampedErrorFileRSA.json  >/tmp/demo.log 2>&1  || true
      export NUM_FILES=$(ls | wc -l)
      #rm $actFile
      #rm /tmp/timestampedErrorFiles-logs.json
      #cat xaa
      cd -   >/tmp/demo.log 2>&1  || true
      echo " "
      echo "         ✅ OK"

done


